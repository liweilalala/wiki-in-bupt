## 数据绑定·事件处理 ##

#### 写在前面--基础语法 ####

- 变量

变量使用var关键字来进行声明，可以将变量理解为一个容器，用以存储各类型的数据，例如

```
var num = 0; //声明一个变量，变量名为num，并赋值为0
num = "string" //将变量num重新赋值为字符串string
```

- 函数语法

在js中，函数代表着一种功能。对于一些需要重复操作的功能，我们便可以将其封装成一个函数。
当我们使用function关键字的时候，便定义了一个函数，如下所示

```
//定义一个名为query的函数，调用它会在控制台上输出文字
function query() {
    console.log('query函数被执行')
}

//定义一个名为add的函数，函数接受两个参数，
//返回两参数的和。注意js中参数的表达方法，不需要在前面加var或int等任何关键字
function add(a, b) {
    return a + b;
}

//在对象的属性值中声明函数，此时函数名为属性名query，
//属性值为函数的属性又可称为方法
var object = {
    name: "test",
    query: function () {

    }
}
```

函数在定义好了之后不会被执行，需要我们通过执行号()来执行，小括号中可以写需要传入函数的参数，不同参数之间用逗号隔开。具体形式如下：

```
//执行query函数
query();
//执行add函数，传入1和2两个参数，函数执行后会将二者加和并将结果赋值给sum变量
var sum = add(1, 2);
//执行object对象中的query属性(方法), 这种执行函数的方式又被称作方法的调用
object.query();
```

#### 文件结构 ####

在一个页面文件夹里有四个文件，后缀名分别是js、wxml、wxss及json。
json文件是用来配置页面的，比如导航条的颜色、文字，是否开启下拉刷新等。和页面具体的显示内容、操作等没有太大关系。
wxml是HTML(超文本标记语言)的微信版本，其作用是构建出页面的整体**结构**，以标签的形式向页面中添加文字和各种组件
wxss是CSS(层叠样式表)的微信版本，负责书写**样式**，其作用是让页面更加美观，一般对页面的功能没有影响
js文件即为JavaScript脚本文件，其作用是书写页面逻辑，构建页面的**行为**,如设置按钮点击后的操作等

#### 从代码入手 ####

```
Page({
  data:{
    hw: "Hello World",
    word1:"Hello",
    word2:"World",
    word3: "你好",
    word4: "世界"
    }
})
```

有了上面的基础后，我们尝试着去阅读代码，发现整个js文件实际上只有一句Page()，代表执行Page函数，同时传入了一个对象作为参数。这是由小程序的执行机制决定的，我们主要关心这个作为参数传入的对象，以及它的所有属性(如上述代码中data便是它的属性)。在小程序中，wxml文件里并没有写入字符串"Hello world" "你好"等，那么它们是怎么显示到页面上的呢，这就涉及到了**数据绑定**的概念

#### 数据绑定 ####

在书写wxml代码时，不直接写入要显示的内容，而是先写入一个容器来占位，再通过js向容器中添入数据。
这种方法便可以理解为数据绑定。在wxml中，用{{}}双大括号包裹的内容会被当做一个变量，也就是所谓的容器。容器的内容则对应于js文件里**data对象中同名属性的属性值**。
例如我们书写{{hw}}在wxml中，小程序便会去js中寻找data对象里面hw这个属性，而这个属性的值为"Hello World"，便把这串字符拿到页面里将{{hw}}替换，从而将文字显示了出来。hw在wxml中可以理解为容器名，在js中可以理解为容器的索引，只有在这两个文件里容器名和索引名相同，才能把"Hello World"这串数据传递到wxml的相应位置中，这便是绑定。

```
<view class="section"> 例4 </view>

<view class='redX'> {{hw}} </view>
<view class='blueX'> {{hw}} </view>
```
#### 视图层与逻辑层 ####

所谓视图层，既是我们所能看见的页面，而逻辑层是一个抽象的概念，负责处理页面的行为和更新页面的内容。
例如在程序运行的过程中我们要更改数wxml页面中容器的内容(更新数据绑定)，需要通过wx.setData函数更新data对象的内容，页面的显示便发生了变化。setData函数有一个特殊的功能，就是调用它更改了data对象后，会通知页面去刷新，所以直接更改data页面内容并不会变化。通知页面刷新的信号，便是逻辑层向视图层传递的。
再例如我们在wxml里定义了一个按钮，点击它了以后，视图层会通知逻辑层有一个按钮被点击，逻辑层收到了这个通知后，便开始着手处理按钮被点击后的逻辑操作了。
然而，如果页面中有多个按钮，逻辑层怎么知道视图层被点击的是哪个按钮呢？看来视图层向逻辑层传递的内容不仅仅是有一个按钮被点击这么简单

#### 事件绑定与事件处理 ####

在实验六中，我们看到按钮标签上还有一个属性bindtap，这个属性定义的是按钮被点击后需要执行的函数。所以后面的query是我们自己起的名字，同时在js中，也一定会存在一个名为query的函数。
按钮被点击可以称为一个事件，我们事先写好了一个函数用来告诉逻辑层按钮被点击后应该做什么，当按钮真的被点击时，逻辑层会执行这个函数，这便是**事件处理**。而执行的是哪个函数呢，出现了两次的query告诉我们，视图层在通知逻辑层按钮被点击的时候还会附带一个函数名，指代需要被执行的函数，也可以说，query这个事件处理函数被绑定到了按钮上，这就是**事件绑定**
```
<button bindtap='query'>点击查询mongodb的数据：</button>
```

#### 后续 ####
由于篇幅有限，wiki中所讲到的内容仅仅是小程序编程的一小部分，而更多的操作方法与运行机制在等着你去探索。只要静下心仔细思考，寻找代码中的相同与不同，不断尝试直到自己解决所有的报错，看似深奥的程序便会被你所驾驭。代码只是一个工具和手段，目的在每个人的心中。


